% Version 2.1 April 2023
% See section 11 of the User Manual for version history
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                                                 %%
%% Please do not use \input{...} to include other tex files.       %%
%% Submit your LaTeX manuscript as one .tex document.              %%
%%                                                                 %%
%% All additional figures and files should be attached             %%
%% separately and not embedded in the \TeX\ document itself.       %%
%%                                                                 %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%\documentclass[referee,sn-basic]{sn-jnl}% referee option is meant for double line spacing

%%=======================================================%%
%% to print line numbers in the margin use lineno option %%
%%=======================================================%%

%%\documentclass[lineno,sn-basic]{sn-jnl}% Basic Springer Nature Reference Style/Chemistry Reference Style

%%======================================================%%
%% to compile with pdflatex/xelatex use pdflatex option %%
%%======================================================%%

%%\documentclass[pdflatex,sn-basic]{sn-jnl}% Basic Springer Nature Reference Style/Chemistry Reference Style


%%Note: the following reference styles support Namedate and Numbered referencing. By default the style follows the most common style. To switch between the options you can add or remove �Numbered� in the optional parenthesis. 
%%The option is available for: sn-basic.bst, sn-vancouver.bst, sn-chicago.bst, sn-mathphys.bst. %  
 
%%\documentclass[sn-nature]{sn-jnl}% Style for submissions to Nature Portfolio journals
%%\documentclass[sn-basic]{sn-jnl}% Basic Springer Nature Reference Style/Chemistry Reference Style
%%\documentclass[sn-mathphys,Numbered]{sn-jnl}% Math and Physical Sciences Reference Style
%%\documentclass[sn-aps]{sn-jnl}% American Physical Society (APS) Reference Style
\documentclass[sn-vancouver,Numbered]{sn-jnl}% Vancouver Reference Style
%%\documentclass[sn-apa]{sn-jnl}% APA Reference Style 
%%\documentclass[sn-chicago]{sn-jnl}% Chicago-based Humanities Reference Style
%%\documentclass[default]{sn-jnl}% Default
%%\documentclass[default,iicol]{sn-jnl}% Default with double column layout

%%%% Standard Packages
%%<additional latex packages if required can be included here>

\usepackage{graphicx}%
\usepackage{multirow}%
\usepackage{amsmath,amssymb,amsfonts}%
\usepackage{amsthm}%
\usepackage{mathrsfs}%
\usepackage[title]{appendix}%
\usepackage{xcolor}%
\usepackage{textcomp}%
\usepackage{manyfoot}%
\usepackage{booktabs}%
\usepackage{algorithm}%
\usepackage{algorithmicx}%
\usepackage{algpseudocode}%
\usepackage{listings}%
%%%%

\lstset{
    texcl=true,
    basicstyle=\small\sf,
    commentstyle=\small\rm,
    mathescape=true,
    escapeinside={(*}{*)}
}

%%%%%=============================================================================%%%%
%%%%  Remarks: This template is provided to aid authors with the preparation
%%%%  of original research articles intended for submission to journals published 
%%%%  by Springer Nature. The guidance has been prepared in partnership with 
%%%%  production teams to conform to Springer Nature technical requirements. 
%%%%  Editorial and presentation requirements differ among journal portfolios and 
%%%%  research disciplines. You may find sections in this template are irrelevant 
%%%%  to your work and are empowered to omit any such section if allowed by the 
%%%%  journal you intend to submit to. The submission guidelines and policies 
%%%%  of the journal take precedence. A detailed User Manual is available in the 
%%%%  template package for technical guidance.
%%%%%=============================================================================%%%%

%\jyear{2021}%

%% as per the requirement new theorem styles can be included as shown below
%%\theoremstyle{thmstyleone}%
%%\newtheorem{theorem}{Theorem}%  meant for continuous numbers
%%\newtheorem{theorem}{Theorem}[section]% meant for sectionwise numbers
%% optional argument [theorem] produces theorem numbering sequence instead of independent numbers for Proposition
%%\newtheorem{proposition}[theorem]{Proposition}% 
%%\newtheorem{proposition}{Proposition}% to get separate numbers for theorem and proposition etc.

%%\theoremstyle{thmstyletwo}%
%%\newtheorem{example}{Example}%
%%\newtheorem{remark}{Remark}%

%%\theoremstyle{thmstylethree}%
%%\newtheorem{definition}{Definition}%

\raggedbottom
%%\unnumbered% uncomment this for unnumbered level heads

\begin{document}

\title[Comparing ChatGPT-4 to Physicians for Assigning Causes of Death from Verbal Autopsy: A Case Study of 6939 Deaths in Sierra Leone from 2019-2022]{Comparing ChatGPT-4 to Physicians for Assigning Causes of Death from Verbal Autopsy: A Case Study of 6939 Deaths in Sierra Leone from 2019-2022}

%%=============================================================%%
%% Prefix	-> \pfx{Dr}
%% GivenName	-> \fnm{Joergen W.}
%% Particle	-> \spfx{van der} -> surname prefix
%% FamilyName	-> \sur{Ploeg}
%% Suffix	-> \sfx{IV}
%% NatureName	-> \tanm{Poet Laureate} -> Title after name
%% Degrees	-> \dgr{MSc, PhD}
%% \author*[1,2]{\pfx{Dr} \fnm{Joergen W.} \spfx{van der} \sur{Ploeg} \sfx{IV} \tanm{Poet Laureate} 
%%                 \dgr{MSc, PhD}}\email{iauthor@gmail.com}
%%=============================================================%%

\author*[1,2]{\fnm{Richard} \sur{Wen}}\email{richard.wen@unityhealth.to}

\author[1,5]{\fnm{Rajeev} \sur{Kamadod}}\email{rajeevk@kentropy.com}

\author[1]{\fnm{Cheryl} \sur{Chin}}\email{cheryl.chin@unityhealth.to}

%\equalcont{These authors contributed equally to this work.}

\author[1,3]{\fnm{Asha} \sur{Behdinan}}\email{asha.behdinan@mail.utoronto.ca}

\author[1]{\fnm{Leslie} \sur{Newcombe}}\email{leslie.newcombe@unityhealth.to}

\author[1,3]{\fnm{Areeba} \sur{Zubair}}\email{areeba.zubair@mail.utoronto.ca}

\author[1]{\fnm{Thomas Kai Sze} \sur{Ng}}\email{KaiSze.Ng@unityhealth.to}

\author[1]{\fnm{Andy} \sur{Lee}}\email{Andy.Lee2@unityhealth.to}

\author[1,2]{\fnm{Paijani} \sur{Sheth}}\email{paijani.sheth@mail.utoronto.ca}

\author[1]{\fnm{Anteneh Tesfaye} \sur{Assalif}}\email{antenehta@gmail.com}

\author[1,4]{\fnm{Patrick} \sur{Brown}}\email{}

\author[1,2]{\fnm{Prabhat} \sur{Jha}}\email{prabhat.jha@utoronto.ca}

\affil*[1]{\orgdiv{Centre for Global Health Research, St. Michael's Hospital}, \orgname{Unity Health Toronto}, \orgaddress{\street{30 Bond St}, \city{Toronto}, \postcode{M5B 1W8}, \state{Ontario}, \country{Canada}}}

\affil[2]{\orgdiv{Dalla Lana School of Public Health}, \orgname{University of Toronto}, \orgaddress{\street{155 College Street}, \city{Toronto}, \postcode{M5T 3M7}, \state{Ontario}, \country{Canada}}}

\affil[3]{\orgdiv{Department of Surgery}, \orgname{University of Toronto}, \orgaddress{\street{149 College Street}, \city{Toronto}, \postcode{M5T 1P5}, \state{Ontario}, \country{Canada}}}

\affil[4]{\orgdiv{Department of Statistical Sciences}, \orgname{University of Toronto}, \orgaddress{\street{700 University Avenue}, \city{Toronto}, \postcode{M5G 1Z5}, \state{Ontario}, \country{Canada}}}

\affil[5]{\orgname{Kentropy Technologies Pvt. Ltd.}, \orgaddress{\street{2nd Main Rd}, \city{Bengaluru}, \postcode{560 034}, \state{Bangalore}, \country{India}}}

%%==================================%%
%% sample for unstructured abstract %%
%%==================================%%

\abstract{\textbf{Background:} Verbal Autopsies (VAs) collect data on deaths and their causes outside of traditional hospital settings to provide more representative counts and Causes of Death (CODs) for reducing premature mortality. Current computer models for COD assignment in VAs perform similar to physicians at the population level, but poorly at the individual level, due to a focus on structured questionnaire data and neglecting free text from the open narratives. Recently, a Generative Pre-trained Transformer (GPT) model called ChatGPT-4 has demonstrated human-level performance on professional and academic exams using free text input. ChatGPT-4 shows promise in mimicking physician behavior for assigning CODs, but to the best of our knowledge, has yet to be tested for assigning CODs using open narratives from VAs.

\textbf{Methods:} 6939 records collected from VA in Sierra Leone from 2019 to 2022 were used to compare four computer models, ChatGPT-3.5, ChatGPT-4, InterVA-5, and InSilicoVA, to physicians for assigning CODs at the population and individual level. Open narratives were used for Chat-3.5/ChatGPT-4 input, while structured questionnaires were used for InterVA-5/InSilicoVA input. All COD assignments were grouped into general COD categories consisting of 19, 10, and 7 categories for the adult, child, and neonatal age groups. Cause Specific Mortality Fraction (CSMF) accuracy and Partial Corrected Concordance (PCCC) were used to compare models to physicians at the population and individual level respectively. Comparisons in CSMF and PCCC to physicians among models were evaluated for all records and by COD, age group, and age ranges.

\textbf{Results:} x.

\textbf{Conclusion:} x.
}

%%================================%%
%% Sample for structured abstract %%
%%================================%%

% \abstract{\textbf{Purpose:} The abstract serves both as a general introduction to the topic and as a brief, non-technical summary of the main results and their implications. The abstract must not include subheadings (unless expressly permitted in the journal's Instructions to Authors), equations or citations. As a guide the abstract should not exceed 200 words. Most journals do not set a hard limit however authors are advised to check the author instructions for the journal they are submitting to.
% 
% \textbf{Methods:} The abstract serves both as a general introduction to the topic and as a brief, non-technical summary of the main results and their implications. The abstract must not include subheadings (unless expressly permitted in the journal's Instructions to Authors), equations or citations. As a guide the abstract should not exceed 200 words. Most journals do not set a hard limit however authors are advised to check the author instructions for the journal they are submitting to.
% 
% \textbf{Results:} The abstract serves both as a general introduction to the topic and as a brief, non-technical summary of the main results and their implications. The abstract must not include subheadings (unless expressly permitted in the journal's Instructions to Authors), equations or citations. As a guide the abstract should not exceed 200 words. Most journals do not set a hard limit however authors are advised to check the author instructions for the journal they are submitting to.
% 
% \textbf{Conclusion:} The abstract serves both as a general introduction to the topic and as a brief, non-technical summary of the main results and their implications. The abstract must not include subheadings (unless expressly permitted in the journal's Instructions to Authors), equations or citations. As a guide the abstract should not exceed 200 words. Most journals do not set a hard limit however authors are advised to check the author instructions for the journal they are submitting to.}

\keywords{Cause of Death, Physician Coding, Verbal Autopsy, GPT}

%%\pacs[JEL Classification]{D8, H51}

%%\pacs[MSC Classification]{35A01, 65L10, 65L12, 65L20, 65L70}

\maketitle

\section{Background}\label{background}

In 2019, 41 million people die prematurely from noncommunicable diseases every year, accounting for 74\% of all deaths globally \cite{worldhealthorganizationNonCommunicableDiseases2019}. Most of these deaths are preventable, but require adequate resource allocation, guided by evidence, to implement effective interventions and policies that target populations at risk \cite{benzigerGlobalBurdenDisease2016}. Thus, reliable counts and diagnoses of deaths enable decision makers to identify populations at risk to save lives and reduce premature deaths worldwide \cite{lawnMillionNeonatalDeaths2010,lassiCommunityBasedIntervention2015,liuExcessMortalityPersons2017,ewigCommunityacquiredPneumoniaEmergency2011}. However, most low-income countries do not have data on deaths or have registered less than half of the deaths in their country, with an even fewer 8\% of these registered deaths having a Cause of Death (COD) recorded \cite{worldhealthorganizationSCOREHealthData2021}. To fill this gap in death registrations, an alternative method known as Verbal Autopsy (VA) is used to collect data on deaths and determine their likely causes at scale \cite{desavignyIntegratingCommunitybasedVerbal2017,thomasVerbalAutopsyHealth2018,rampatigeSystematicReviewStatistics2014}, outside of traditional healthcare facilities where over half of deaths occur at home \cite{adairWhoDiesWhere2021}.

VA involves two major components: survey and COD assignment \cite{worldhealthorganizationVerbalAutopsyStandards2023,chandramohanEstimatingCausesDeath2021,worldhealthorganizationVerbalAutopsyStandards2007}. In the survey component, trained lay surveyors interview those familiar with the deceased (e.g. living spouse, children, family, friends) to gather information using standardized questionnaires and open narratives. In the COD assignment component, physicians evaluate information available from the questionnaires and open narratives to assign probable CODs. Although VA surveys have been an effective alternative to collect mortality data at scale (e.g. less than \$3 USD per house in India \cite{gomesNationwideMortalityStudies2017,jhaProspectiveStudyOne2005}), COD assignment has been criticized to be expensive and difficult to reproduce due to reliance on physician assignment \cite{mccormickProbabilisticCauseofDeathAssignment2016b,morrisFactorsAssociatedPhysician2010,solemanVerbalAutopsyCurrent2006}. As an alternative to physician assignment, computer models, such as InterVA \cite{byassIntegratedApproachProcessing2019} and InSilicoVA \cite{mccormickProbabilisticCauseofDeathAssignment2016b}, have recently been studied to automatically assign CODs with performances close to physicians at the population level, but poor performances at the individual level \cite{jhaAutomatedPhysicianAssignment2019,leitaoComparisonPhysiciancertifiedVerbal2014,desaiPerformanceFourComputercoded2014,tungaVerbalAutopsyModels2021,otiVerbalAutopsyInterpretation2010}. These computer models often utilized data from the structured questionnaire, but often omit the free-text open narrative, which misses latent information, such as chronology or health-seeking behaviors, that may potentially help models perform better than using the questionnaire alone \cite{jebleeAutomaticallyDeterminingCause2019,blancoExtractingCauseDeath2021,kingQualityDiagnosticValue2016}.

Recently, Large Language Models (LLM), leveraging massive datasets and deep learning approaches, have made advances in performing a variety of Natural Language Processing (NLP) tasks using free-text, such as question answering, code generation, and even medical diagnosis \cite{changSurveyEvaluationLarge2023,lundChattingChatGPTHow2023,svyatkovskiyIntelliCodeComposeCode2020,hauptAIGeneratedMedicalAdvice2023}. On November 30, 2022, a widely-available LLM called ChatGPT was released by OpenAI with capabilities of answering natural language text inquiries using training data up to September 2021. ChatGPT-3 was based on several Generative Pre-trained Transformer (GPT) models between 2018 to 2020, namely GPT-1 to GPT-3, which had notable differences in training data sizes of 5 gigabytes to 45 terabytes from web sources that resulted in 117 million to 175 billion parameter models \cite{wuBriefOverviewChatGPT2023}. On March 14, 2023, ChatGPT-4 was released with human-level performance on various professional and academic exams and benchmarks that outperformed ChatGPT-3 \cite{openaiGPT4TechnicalReport2023a}. Given the limited usage of free-text open narratives in computer models for determining CODs, and recent advances in LLMs that leverage natural language text prompts, we conduct a case study with Sierra Leone deaths from VA in 2019 to 2022 to compare four models, ChatGPT-3.5, ChatGPT-4, InterVA-5, and InSilicoVA, to physicians for determining CODs.

\section{Methods}\label{methods}

This study uses 6939 physician agreed records of 11,920 records collected in 2019 to 2022 from the Healthy Sierra Leone (HEAL-SL) study as described in Section \ref{methods-data}. Section \ref{methods-models} describes the four models, ChatGPT-3.5, ChatGPT-4, InterVA-5, and InSilicoVA, for COD assignment, and their inputs and outputs, while section \ref{methods-eval} details the performance evaluation of the four models relative to physicians overall, by ages, and by COD, using population and individual level metrics. Figure \ref{fig-methods} details the methods used in this study.

\begin{figure}[h!]
\centering
\includegraphics[width=0.7\textwidth]{fig-methods.pdf}
\caption{Case study methods. VA records in Sierra Leone between 2019-2022 from the HEAL-SL study were filtered for physician agreed records, and pre-processed for COD assignment by ChatGPT-3.5, ChatGPT-4, InterVA-5 and InSilicoVA models. The output models were evaluated with CSMF Accuracy and PCCC overall, by age group, and by COD and five-year age ranges for each age group.}\label{fig-methods}
\end{figure}

\subsection{Verbal Autopsy (VA) Data}\label{methods-data}

Initially, 11,920 records from the HEAL-SL study \cite{njalauniversityHealthySierraLeone2023,carshon-marshChildMaternalAdult2022} were collected from dual-coded EVA, where each record was randomly coded by two different physicians that assigned CODs as International Classification of Diseases Revision 10 (ICD-10) codes \cite{worldhealthorganizationICD10InternationalStatistical2011}. Physicians were able to assign CODs for 11,820 of the 11,920 records, where 100 of these records could not be assigned a COD due to missing or inadequate information (e.g. low quality narrative, data loss). To determine if two codes were in physician agreement per record, codes were compared for similarity using Central Medical Evaluation Agreement 10 (CMEA-10) codes, which groups a range of similar ICD-10 codes together indicating codes in agreement \cite{aleksandrowiczPerformanceCriteriaVerbal2014} (see Additional File 2). When codes were not in agreement, a record enters the reconciliation phase, where the two physicians were provided reasoning and initial codes from each other to: (1) keep their initial code (2) assign the other physician's code or (3) assign a new code. If codes were not in agreement after the reconciliation phase, a record enters the adjudication phase, where a third senior physician evaluates both physicians' reasoning and codes before and after reconciliation, and assigns a final code based on their evaluation. The 11,820 physician coded records were further filtered for records where both physicians agreed on the assigned codes (records that were not reconciled or adjudicated) resulting in 6942 physician agreed records. Since computer models were compared to physicians in this study, there was more certainty that COD assignments agreed by both physicians were representative of physician assignment than when they disagreed \cite{barnettComparativeAccuracyDiagnosis2019,morrisFactorsAssociatedPhysician2010,hsiaoFactorsAssociatedPhysician2012}. The 6942 records were converted into CGHR-10 codes (see Additional File 1) that generalized ICD-10 codes into 19, 10, and 7 categories for the adult (12 years or older), child (28 days to 11 years), and neonatal (under 28 days) age groups.  After conversion, a final total of 6939 physician agreed records (3826 adult, 2636 child, and 477 neonatal) were used for modelling and performance evaluation, where three records were removed as their ICD-10 codes did not have a matching CGHR-10 code.

The 6939 physician agreed records were relatively evenly distributed (approximately 40-57\% male and female) for the adult, child, and neonatal age groups in terms of sex (Figure \ref{fig-data-agesex}) with the most records in the 1-5 year (n=1633, 24\%) age range, and the least records in the 10-14 year (n=135, 2\%) and 7-27 day (n=82, 1\%) age ranges (Figure \ref{fig-data-agerange}). The other 15 five-year age ranges within 0 days to 69 years were relatively evenly distributed with approximately 4-6\% of the 6939 records each. The 3826 adult records had most records in the 65-69 year (n=575, 15\%), and the least in the 10-14 year (n=135, 4\%) age ranges, while the other 10 age ranges were relatively evenly distributed at 7-9\% of all records (Figure \ref{fig-data-agerange-adult}). For adult CODs, Malaria (n=799, 21\%) had the highest number of adult records, and cancers (n=49, 1\%), diabetes mellitus (n=27, \textless 1\%), and suicide (n=3, \textless 1\%) had the lowest number adult of adult records, while the other 15 CODs had between 2-11\% of all adult records (Figure \ref{fig-data-cod-adult}). The 2636 child records had most records in the 1-5 year (n=1633, 62\%) age range while the three other age ranges were relatively evenly distributed at 12-14\% of all records (Figure \ref{fig-data-agerange-child}). For child CODs, Malaria (n=1382, 52\%) and other infections (n=667, 25\%) had the highest number of child records, while nutritional deficiencies (n=11, \textless 1\%) and congenital anomalies (n=1, \textless 1\%) had the lowest number of records with the five other CODs between 3-7\% of all child records. The 477 neonatal records had two age ranges with most records in the 0-6 day (n=395, 83\%) age range and the rest in the 7-27 day (n=82, 17\%) age range (Figure \ref{fig-data-agerange-neo}). For neonatal CODs, stillbirth (n=172, 36\%) had the highest number of neonatal records, and ill-defined (n=23, 5\%), other (n=5, 1\%), and congenital anomalies (n=2, \textless 1\%) had the least number of records with the rest of the other three CODs between 15-22\% of all neonatal records (Figure \ref{fig-data-cod-neo}). See Appendices \ref{app-data} to \ref{app-data-neo} for a list of figures \ref{fig-data-agesex} to \ref{fig-data-cod-neo} showing distributions of the 6939 physician agreed records.

\subsection{Modelling}\label{methods-models}

Four computer models were used to assign COD for each of the 6939 physician agreed records: ChatGPT-3.5, ChatGPT-4, InterVA-5 , and InSilicoVA. Each model required pre-processing of the 6939 records into input data, and standardization of output COD codes from models for performance evaluation as not all models produced comparable codes across outputs. Although each model can assign multiple CODs per record, only the first generated COD response from ChatGPT-3.5 and ChatGPT-4, and the most probable COD from InterVA-5 and InSilicoVA were used for evaluation. All model outputs were converted to CGHR-10 codes to evaluate performances of models for COD assignment relative to physicians.

\subsubsection{Overview of ChatGPT-3.5/4, InterVA-5, and InSilicoVA}\label{methods-models-overview}

ChatGPT-3.5 \cite{brownLanguageModelsAre2020} and ChatGPT-4 \cite{openaiGPT4TechnicalReport2023a} are LLMs that utilize deep neural networks with transformer architectures \cite{vaswaniAttentionAllYou2017} and reinforcement learning from human feedback \cite{ouyangTrainingLanguageModels2022,christianoDeepReinforcementLearning2017,stiennonLearningSummarizeHuman2020,wirthSurveyPreferencebasedReinforcement2017} to follow instructions from prompts and provide human-level responses, with known differences in ChatGPT-4 possessing multimodal capabilites (e.g. image/voice input/output), more recent training data, and improved responses compared to ChatGPT-3 \cite{wuBriefOverviewChatGPT2023}. ChatGPT-3.5 and ChatGPT-4 were instructed with text prompts to assign CODs based on the open narrative. InterVA-5 and InSilicoVA are widely used and studied \cite{murrayUsingVerbalAutopsy2014,otiVerbalAutopsyInterpretation2010,benaraEvaluationMethodsAssigning2023,chandramohanEstimatingCausesDeath2021,tungaVerbalAutopsyModels2021,leitaoComparisonPhysiciancertifiedVerbal2014,jhaAutomatedPhysicianAssignment2019} standard statistical models for COD assignment in VAs under the openVA framework \cite{liOpenVAToolkitVerbal2023}. InterVA-5 applies Bayesian probabilistic modelling \cite{bayesEssaySolvingProblem1958} using a set of standardized symptoms from reports and related conditional probabilities from medical experts to assign CODs based on the highest probability \cite{byassIntegratedApproachProcessing2019,byassStrengtheningStandardisedInterpretation2012}. InSilicoVA improves upon InterVA (e.g. comparable probabilities across individuals, measures of uncertainty, and inclusion of additional data sources) with a hierarchical Bayesian framework and Markov Chain Monte Carlo (MCMC) simulations \cite{brooksMarkovChainMonte1998,chibMarkovChainMonte2001,hanMarkovChainMonte2001} to incorporate multiple sources of uncertainty for assigning CODs based on the highest probability \cite{mccormickProbabilisticCauseofDeathAssignment2016b}. For assigning CODs, ChatGPT-3.5 and ChatGPT-4 require prompts containing conversation-like textual instructions as input, while InterVA-5 and InSilicoVA require structured symptom and associated sociodemographic data as input. 

\subsubsection{Input Data and Preprocessing}\label{methods-models-input}

For ChatGPT-3.5 and ChatGPT-4, 6939 text prompts were generated for each physician agreed record as input to instruct the models to assign CODs based on the open narratives. Prompts were generated with a template involving \verb|<narrative>| from the free-text open narratives, and associated \verb|<age>|, (age) \verb|<unit>|, \verb|<sex>| from the standardized questionnaire:

\begin{lstlisting}
Determine the underlying cause of death and provide a ICD-10 code 
for the following narrative based on a verbal autopsy of a death in 
Sierra Leone, Age <age> <unit>, <sex>: <narrative>
\end{lstlisting}

\noindent For InterVA-5 and InSilicoVA, the standardized questionnaire data from the HEAL-SL EVA were first converted into 2016 World Health Organization (WHO) VA questionnaire revision 1.5.1 Open Data Kit (ODK) format \cite{worldhealthorganizationODKVerbalAutopsy2022,nafundiODKCollectData2023} consisting of 526 variables \cite{dipasqualeReleaseODK20162016}, followed by further conversion into OpenVA format \cite{liOpenVAToolkitVerbal2023} consisting of 353 variables \cite{byassInterVA5UserGuide2020} using the \verb|pyCrossVA| Python package \cite{thomasPycrossvaPrepareData}. The 6939 records were all converted into OpenVA formatted records for InterVA-5 and InSilicoVA.

\subsubsection{Model Parameters}\label{methods-models-params}

The parameter \verb|top_p| for ChatGPT-3.5 and ChatGPT-4, representing the sampling temperature, was set to 0.3\footnote{We tested for top\_p values between 0.1 to 0.9 at intervals of 0.1 on five records that did not return outputs from ChatGPT-4 until all five records returned output. At top\_p=0.3, all five records produced output.} to consider only the top 30\% probability mass from the token results \cite{openaiOpenAIPlatformAPI2024}. Higher values closer to 1 may make the results more random, while lower values closer to 0 make the results more focused. The \verb|Nsim| (number of iterations to run) parameter \cite{liInSilicoVAProbabilisticVerbal2022} for InSilicoVA was set to 9500\footnote{The default value of Nsim=10000 for InSilicoVA ran until 9500 iterations before it stopped due to errors, thus Nsim=9500 was used and ran successfully for all iterations.}, while the \verb|HIV| (level of prevalence of human immunodeficiency virus) and \verb|Malaria| (level of prevalence of Malaria) parameters \cite{thomasInterVA5ReplicateAnalyse2021} for InterVA-5 were both set to \verb|'h'| (high) reflecting HIV and Malaria disease assumptions in Sierra Leone \cite{yendewaHIVAIDSSierra2018,walkerMalariaMorbidityMortality2015}.

\subsubsection{Output Data and Code Conversions}\label{methods-models-output}

Of the 6939 input records, ChatGPT-3.5, ChatGPT-4, InterVA-5, and InSilicoVA were able to assign CODs for 6929, 6909, 6805, 6729 records respectively. All 6805 InterVA-5 and 6729 InSilicoVA records with WHO VA 2016 v1.5 output codes \cite{worldhealthorganizationVerbalAutopsyStandards2016} were converted into ICD-10 codes. After all model outputs used ICD-10 codes, they were further converted to CGHR-10 codes. The 6929 ChatGPT-3.5 and 6909 ChatGPT-4 output records with ICD-10 codes were converted into 6892 and 6856 records with CGHR-10 codes, where 37 and 53 records did not have matching CGHR-10 codes respectively. All 6805 InterVA-5 and 6729 InSilicoVA records with ICD-10 codes were converted into records with CGHR-10 codes.

\subsection{Performance Evaluation}\label{methods-eval}

The performance of four models, ChatGPT-3.5, ChatGPT-4, InterVA-5, and InSilicoVA, were evaluated with metrics on the population and individual level by comparing their CGHR-10 COD outputs to 6939 records. Cause Specific Mortality Fraction (CSMF) accuracy was used to evaluate models on the population level, while Partial Chance Corrected Concordance (PCCC) was used to evaluate models on the individual level \cite{murrayRobustMetricsAssessing2011}. Records that were assigned a COD by physicians, but not by a model were considered to be an incorrect COD assignment by the model. CSMF accuracy and PCCC were calculated for each model by three age groups, and further into age ranges and COD for each age group.

\subsubsection{Cause Specific Mortality Fraction (CSMF) Accuracy}\label{methods-eval-csmfa}

CSMF accuracy measures the performance of models at the population level, comparing distributions of CODs between the physicians and the models \cite{murrayRobustMetricsAssessing2011}. To calculate CSMF accuracy, we first calculate $CSMF_j$ as is the fraction of physician or model records for cause $j$, given by dividing the number of records for cause $j$ with the total number of records as seen in Equation \ref{eq-csmf}. Then, the $CSMFMaximumError$, representing the worst possible model, is calculated using Equation \ref{eq-csmferr}. Finally, the CSMF accuracy is given by Equation \ref{eq-csmfa}, where $k$ is the number of causes, $j$ is a cause, $CSMF^{true}_j$ is the true physician CSMF for cause $j$, and $CSMF^{pred}_j$ is the prediction model CSMF for cause $j$. CSMF accuracy ranges from 0 to 1, where 1 means that the model completely matched the physician COD distribution and 0 means that it did not match the distribution at all.

\begin{equation}\label{eq-csmf}
    CSMF_j = Records_j / Records
\end{equation}

\begin{equation}\label{eq-csmferr}
    CSMFMaximumError = 2(1 - Min(CSMF^{true}_j)
\end{equation}

\begin{equation}\label{eq-csmfa}
    CSMFAccuracy = 1 - \frac{\sum^{k}_{j=1}|CSMF^{true}_j - CSMF^{pred}_j|}{CSMFMaximumError}
\end{equation}

\subsubsection{Partial Chance Corrected Concordance (PCCC)}\label{methods-eval-pccc}

PCCC measures the performance of models at the individual level, comparing COD assignments between the physicians and models on a record by record basis, correcting for COD assignments made purely by chance \cite{murrayRobustMetricsAssessing2011}. PCCC is given by Equation \ref{eq-pccc}, where $k$ is the number of top COD assignments from the model to consider, $N$ is number of causes, and $C$ is fraction of records where the physician COD assignment is one of the top COD assignments from the model. For this study, we set $k$ to 1, making $C$ equivalent to the fraction of true positives $TP$ or records where the physician COD assignment is equal to the model COD assignment as shown in Equation \ref{eq-pccc-c}. Higher PCCC values closer to 1 indicate that model COD assignments are similar to physician COD assignments, while values closer to 0 indicate that model COD assignments are not similar to physicians.

\begin{equation}\label{eq-pccc-c}
    C = \frac{TP}{Records}
\end{equation}

\begin{equation}\label{eq-pccc}
    PCCC(k) = \frac{C - \frac{k}{N}}{1 - \frac{k}{N}}
\end{equation}

\subsubsection{Metrics Overall and by Age and Cause of Death}\label{methods-eval-agecod}

The CSMF accuracy and PCCC metrics were calculated and compared for each model overall and by age group, followed by age ranges and COD for each age group as model performance can vary across ages and specific causes \cite{benaraEvaluationMethodsAssigning2023,murrayUsingVerbalAutopsy2014,setelValidityVerbalAutopsy2006}. Metrics were calculated overall for three age groups according to the CGHR-10 codes: adult (12 years or older), child (28 days to 11 years), and neonatal (under 28 days). For each of the adult and child age groups, metrics were calculated for five-year age ranges for records with ages at death of one-year or older and five-month age ranges for 28 days or older. For the neonatal age group, the age ranges of 0-6 days and 7-27 days were used. Metrics were also calculated by CODs defined by CGHR-10 codes, which include 19, 10, and 7 CODs for adult, child, and neonatal records respectively.

\section{Results}\label{results}

x.

\subsection{Overall Performance}\label{results-overall}

x.

\subsection{Performance for Adult Records (12 Years or Older)}\label{results-adult}

x.

\begin{figure}[h!]
\centering
\includegraphics[width=0.7\textwidth]{fig-perf-agerange-adult.pdf}
\caption{Model performance for assigning causes of death in the adult age group (12 to 69 Years) by five-year age ranges. PCCC values are sorted by the highest to lowest PCCC for each age range. Only models with PCCC values close to the highest and lowest PCCC are shown.}\label{fig-perf-agerange-adult}
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=0.7\textwidth]{fig-perf-cod-adult.pdf}
\caption{Model performance for assigning causes of death in the adult age group (12 to 69 Years) by five-year age ranges. PCCC values are sorted by the highest to lowest PCCC for each age range. Only models with PCCC values close to the highest and lowest PCCC are shown.}\label{fig-perf-agerange-adult}
\end{figure}

\subsection{Performance for Child Records (28 Days to 11 Years)}\label{results-child}

x.

\subsection{Performance for Neonatal Records (Under 28 Days)}\label{results-neo}

x.

\section{Discussion}\label{discuss}

x.

\subsection{Advantages}\label{discuss-adv}

x.

\subsection{Disadvantages}\label{discuss-disadv}

x.

Dimensions and cost of LLM versus physician.

Reliance on third-party hosting.

\subsection{Limitations}\label{discuss-limits}

x.

Did not explore effects of model parameters outside the default (e.g. ChatGPT temperature, etc).

\subsection{Research Opportunities}\label{discuss-opp}

x.

\section{Conclusion}\label{conclude}

Conclusions may be used to restate your hypothesis or research question, restate your major findings, explain the relevance and the added value of your work, highlight any limitations of your study, describe future directions for research and recommendations. 

In some disciplines use of Discussion or 'Conclusion' is interchangeable. It is not mandatory to use both. Please refer to Journal-level guidance for any specific requirements. 

\backmatter

\bmhead{Supplementary information}

% If your article has accompanying supplementary file/s please state so here. 

% Authors reporting data from electrophoretic gels and blots should supply the full unprocessed scans for key as part of their Supplementary information. This may be requested by the editorial team/s if it is missing.

% Please refer to Journal-level guidance for any specific requirements.

Additional files were used to supplement this paper:

\begin{itemize}
    \item Additional file 1: Centre for Global Health Research 10 (CGHR-10) codes. Codes grouping ICD-10 code ranges into generalized categories. (.csv)
    \item Additional file 2: Central Medical Evaluation Agreement 10 (CMEA-10) codes. ICD-10 code ranges considered in physician agreement. (.csv)
\end{itemize}

\bmhead{Acknowledgments}

% Acknowledgments are not compulsory. Where included they should be brief. Grant or contribution numbers may be acknowledged.

% Please refer to Journal-level guidance for any specific requirements.

\section*{Declarations}

% Some journals require declarations to be submitted in a standardised format. Please check the Instructions for Authors of the journal to which you are submitting to see if you need to complete this section. If yes, your manuscript must contain the following sections under the heading `Declarations':

% \begin{itemize}
% \item Funding
% \item Conflict of interest/Competing interests (check journal-specific guidelines for which heading to use)
% \item Ethics approval 
% \item Consent to participate
% \item Consent for publication
% \item Availability of data and materials
% \item Code availability 
% \item Authors' contributions
% \end{itemize}

% \noindent
% If any of the sections are not relevant to your manuscript, please include the heading and write `Not applicable' for that section. 

\subsection*{Availability of data and materials}

The datasets supporting the conclusions of this article are included within the article (and its additional files).

\newpage
\begin{appendices}

%\section{Section title of first appendix}\label{secA1}

%An appendix contains supplementary information that is not an essential part of the text itself but which may be helpful in providing a more comprehensive understanding of the research problem or it is information that is too cumbersome to be included in the body of the paper.
    
%%=============================================%%
%% For submissions to Nature Portfolio Journals %%
%% please use the heading ``Extended Data''.   %%
%%=============================================%%

%%=============================================================%%
%% Sample for another appendix section			       %%
%%=============================================================%%

%% \section{Example of another appendix section}\label{secA2}%
%% Appendices may be used for helpful, supporting or essential material that would otherwise 
%% clutter, break up or be distracting to the text. Appendices can consist of sections, figures, 
%% tables and equations etc.

\section{Physician Agreed Verbal Autopsy Records}\label{app-data}

The following figures visualize the distribution of all physician agreed records by age groups (Figure \ref{fig-data-agesex}) and 5-year age ranges (Figure \ref{fig-data-agerange}) in Sierra Leone from 2019 to 2022.

\begin{figure}[h]
\centering
\includegraphics[width=1\textwidth]{fig-data-agesex.pdf}
\caption{Number of physician agreed VA records by adult, child, and neonatal age groups in Sierra Leone from 2019 to 2022.}\label{fig-data-agesex}
\end{figure}

\newpage
\begin{figure}[h]
\centering
\includegraphics[width=0.85\textwidth]{fig-data-agerange.pdf}
\caption{Number of physician agreed VA records by 5-year age ranges in Sierra Leone from 2019 to 2022.}\label{fig-data-agerange}
\end{figure}


\newpage
\section{Adult Physician Agreed Verbal Autopsy Records (12 Years or Older)}\label{app-data-adult}

The following figures visualize the distribution of adult physician agreed records by 5-year age ranges (Figure \ref{fig-data-agerange-adult}) and CGHR-10 COD code in Sierra Leone from 2019 to 2022 (Figure \ref{fig-data-cod-adult}).

\begin{figure}[h]
\centering
\includegraphics[width=0.95\textwidth]{fig-data-agerange-adult.pdf}
\caption{Number of physician agreed adult (12 years or older) VA records by 5-year age ranges in Sierra Leone from 2019 to 2022.}\label{fig-data-agerange-adult}
\end{figure}

\newpage
\begin{figure}[h]
\centering
\includegraphics[width=0.85\textwidth]{fig-data-cod-adult.pdf}
\caption{Number of physician agreed adult (12 years or older) VA records by CGHR-10 COD code in Sierra Leone from 2019 to 2022.}\label{fig-data-cod-adult}
\end{figure}

\newpage
\section{Child Physician Agreed Verbal Autopsy Records (28 Days to 11 Years)}\label{app-data-child}

The following figures visualize the distribution of child physician agreed records by 5-year age ranges (Figure \ref{fig-data-agerange-child}) and CGHR-10 COD code in Sierra Leone from 2019 to 2022 (Figure \ref{fig-data-cod-child}).

\begin{figure}[h]
\centering
\includegraphics[width=0.7\textwidth]{fig-data-agerange-child.pdf}
\caption{Number of physician agreed child (28 days to 11 years) VA records by 5-year age ranges in Sierra Leone from 2019 to 2022.}\label{fig-data-agerange-child}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=0.85\textwidth]{fig-data-cod-child.pdf}
\caption{Number of physician agreed child (28 days to 11 years) VA records by CGHR-10 COD code in Sierra Leone from 2019 to 2022.}\label{fig-data-cod-child}
\end{figure}

\newpage
\section{Neonatal Physician Agreed Verbal Autopsy Records (Under 28 Days)}\label{app-data-neo}

The following figures visualize the distribution of neonatal physician agreed records by 5-year age ranges (Figure \ref{fig-data-agerange-neo}) and CGHR-10 COD code in Sierra Leone from 2019 to 2022 (Figure \ref{fig-data-cod-neo}).

\begin{figure}[h]
\centering
\includegraphics[width=0.75\textwidth]{fig-data-agerange-neo.pdf}
\caption{Number of physician agreed neonatal (less than 28 days) VA records by 5-year age ranges in Sierra Leone from 2019 to 2022.}\label{fig-data-agerange-neo}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=0.85\textwidth]{fig-data-cod-neo.pdf}
\caption{Number of physician agreed neonatal (less than 28 days) VA records by CGHR-10 COD code in Sierra Leone from 2019 to 2022.}\label{fig-data-cod-neo}
\end{figure}

\end{appendices}

%%===========================================================================================%%
%% If you are submitting to one of the Nature Portfolio journals, using the eJP submission   %%
%% system, please include the references within the manuscript file itself. You may do this  %%
%% by copying the reference list from your .bbl file, paste it into the main manuscript .tex %%
%% file, and delete the associated \verb+\bibliography+ commands.                            %%
%%===========================================================================================%%

\newpage
\bibliography{bibliography}% common bib file
%% if required, the content of .bbl file can be included here once bbl is generated
%%\input sn-article.bbl


\end{document}
